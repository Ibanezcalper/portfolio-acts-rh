---
import conceptosData from "../../public/conceptos.json";
---

<div class="relative py-24 px-6 overflow-hidden bg-slate-900" id="flash-expert">
    <!-- Fluid background patterns -->
    <div
        class="absolute -top-1/4 -right-1/4 w-[600px] h-[600px] bg-blue-500/10 rounded-full blur-[150px] animate-pulse"
    >
    </div>
    <div
        class="absolute -bottom-1/4 -left-1/4 w-[600px] h-[600px] bg-indigo-500/10 rounded-full blur-[150px] animate-pulse"
    >
    </div>

    <div class="max-w-4xl mx-auto text-center relative z-10">
        <header class="mb-20">
            <span
                class="text-blue-400 font-bold uppercase tracking-[0.3em] text-xs mb-4 block"
                >Entrenamiento Cognitivo</span
            >
            <h2
                class="text-5xl md:text-6xl font-black text-white tracking-tighter mb-6"
            >
                Flashcards de <span
                    class="italic text-blue-500 underline decoration-blue-500/30 underline-offset-8"
                    >Alto Impacto</span
                >
            </h2>
            <p
                class="text-slate-400 text-lg font-medium max-w-xl mx-auto leading-relaxed"
            >
                Refuerza conceptos clave con nuestra interfaz de tarjetas
                interactivas. Toca para ver la definición técnica.
            </p>
        </header>

        <!-- The Card Arena -->
        <div
            class="relative h-[28rem] md:h-[32rem] perspective-[2000px] group cursor-pointer"
            id="flash-box"
        >
            <div
                id="card"
                class="relative w-full h-full transition-transform duration-700 ease-[cubic-bezier(0.34,1.56,0.64,1)] transform-style-3d shadow-2xl rounded-[3rem]"
            >
                <!-- FRONT: Term -->
                <div
                    class="absolute inset-0 w-full h-full backface-hidden bg-white rounded-[3rem] p-12 flex flex-col items-center justify-center border-b-8 border-blue-500"
                >
                    <div
                        class="absolute top-10 left-10 flex items-center gap-3"
                    >
                        <div
                            class="w-10 h-10 rounded-2xl bg-blue-50 flex items-center justify-center text-blue-600"
                        >
                            <svg
                                class="w-5 h-5"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2.5"
                                    d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"
                                ></path>
                            </svg>
                        </div>
                        <span
                            class="text-[10px] font-black tracking-widest text-slate-400 uppercase"
                            id="fc-clase">MÓDULO 01</span
                        >
                    </div>

                    <h3
                        id="fc-termino"
                        class="text-4xl md:text-5xl font-black text-slate-800 leading-tight tracking-tighter mb-10 text-center uppercase"
                    >
                        --
                    </h3>

                    <div
                        class="flex items-center gap-2 text-slate-300 group-hover:text-blue-400 transition-colors animate-bounce"
                    >
                        <span
                            class="text-[10px] font-bold uppercase tracking-widest"
                            >Toca para descubrir</span
                        >
                        <svg
                            class="w-4 h-4"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2.5"
                                d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
                        </svg>
                    </div>
                </div>

                <!-- BACK: Definition -->
                <div
                    class="absolute inset-0 w-full h-full backface-hidden rotate-y-180 bg-white rounded-[3rem] p-12 flex flex-col items-center justify-center border-b-8 border-indigo-600 shadow-inner"
                >
                    <div
                        class="mb-8 p-3 bg-indigo-50 rounded-full text-indigo-600"
                    >
                        <svg
                            class="w-8 h-8"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2.5"
                                d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                            ></path>
                        </svg>
                    </div>

                    <p
                        id="fc-definicion"
                        class="text-xl md:text-2xl font-bold italic text-slate-700 leading-relaxed text-center font-serif"
                    >
                        ...
                    </p>

                    <div
                        class="mt-10 px-6 py-2 bg-slate-50 text-slate-400 rounded-full text-[10px] font-bold uppercase tracking-[0.2em]"
                    >
                        Definición Técnica
                    </div>
                </div>
            </div>
        </div>

        <!-- Progress and Actions -->
        <footer
            class="mt-16 flex flex-col md:flex-row items-center justify-between gap-8 pt-8 border-t border-white/5"
        >
            <div class="flex items-center gap-4">
                <button
                    id="prev-fc"
                    class="p-5 bg-white/5 hover:bg-white/10 text-white rounded-[2rem] transition-all border border-white/10 hover:border-white/20 active:scale-95 group"
                >
                    <svg
                        class="w-6 h-6 group-hover:-translate-x-1 transition-transform"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2.5"
                            d="M15 19l-7-7 7-7"></path>
                    </svg>
                </button>
                <div
                    class="px-6 py-4 bg-white/5 rounded-[2rem] border border-white/10 text-slate-400 font-bold text-sm tracking-widest whitespace-nowrap"
                >
                    CONCEPTO <span id="cur-idx" class="text-white">--</span> DE <span
                        id="tot-idx"
                        class="text-slate-500">--</span
                    >
                </div>
                <button
                    id="next-fc"
                    class="p-5 bg-white group hover:bg-white/90 text-slate-900 rounded-[2rem] transition-all active:scale-95"
                >
                    <svg
                        class="w-6 h-6 group-hover:translate-x-1 transition-transform"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2.5"
                            d="M9 5l7 7-7 7"></path>
                    </svg>
                </button>
            </div>

            <button
                id="random-fc"
                class="flex items-center gap-3 px-8 py-4 bg-blue-600 hover:bg-blue-500 text-white font-black rounded-3xl transition-all shadow-[0_10px_30px_rgba(59,130,246,0.3)] hover:shadow-[0_20px_40px_rgba(59,130,246,0.4)] hover:-translate-y-1 active:scale-95 group"
            >
                <svg
                    class="w-5 h-5 group-hover:rotate-180 transition-transform duration-500"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2.5"
                        d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
                    ></path>
                </svg>
                SALTO ALEATORIO
            </button>
        </footer>
    </div>
</div>

<style>
    .perspective-[2000px] {
        perspective: 2000px;
    }
    .transform-style-3d {
        transform-style: preserve-3d;
    }
    .backface-hidden {
        backface-visibility: hidden;
    }
    .rotate-y-180 {
        transform: rotateY(180deg);
    }
    .is-flipped {
        transform: rotateY(180deg);
    }

    /* Custom Bezier for premium feel */
    #card {
        will-change: transform;
    }
</style>

<script define:vars={{ conceptosData }}>
    let currentIdx = Math.floor(Math.random() * conceptosData.length);
    let isFp = false;

    const box = document.getElementById("flash-box");
    const cardE = document.getElementById("card");
    const termE = document.getElementById("fc-termino");
    const defE = document.getElementById("fc-definicion");
    const clE = document.getElementById("fc-clase");
    const curE = document.getElementById("cur-idx");
    const totE = document.getElementById("tot-idx");
    const nxtE = document.getElementById("next-fc");
    const prvE = document.getElementById("prev-fc");
    const rndE = document.getElementById("random-fc");

    function sync() {
        const item = conceptosData[currentIdx];

        // If flipped, flip back first
        if (isFp) {
            cardE.classList.remove("is-flipped");
            isFp = false;
            setTimeout(() => {
                termE.textContent = item.termino;
                defE.textContent = item.definicion;
                clE.textContent = `MÓDULO 0${item.clase}`;
                curE.textContent = currentIdx + 1;
            }, 300);
        } else {
            termE.textContent = item.termino;
            defE.textContent = item.definicion;
            clE.textContent = `MÓDULO 0${item.clase}`;
            curE.textContent = currentIdx + 1;
        }
        totE.textContent = conceptosData.length;
    }

    box?.addEventListener("click", () => {
        isFp = !isFp;
        cardE.classList.toggle("is-flipped");
    });

    nxtE?.addEventListener("click", (e) => {
        e.stopPropagation();
        currentIdx = (currentIdx + 1) % conceptosData.length;
        sync();
    });

    prvE?.addEventListener("click", (e) => {
        e.stopPropagation();
        currentIdx =
            (currentIdx - 1 + conceptosData.length) % conceptosData.length;
        sync();
    });

    rndE?.addEventListener("click", (e) => {
        e.stopPropagation();
        currentIdx = Math.floor(Math.random() * conceptosData.length);
        sync();
    });

    sync();
</script>
